version: '3'
networks:
  cancer_network:
    driver: bridge
services:

  web-app:
    env_file: .env
    build:
      context: ./web-app
      dockerfile: Dockerfile.dev
    restart: always
    volumes:
      - ./web-app:/code
    networks:
      - cancer_network
    ports:
      - "${WEB_APP_PORT}:${WEB_APP_PORT}"
    command: sh -c "npm run dev"

  api:
    env_file: .env
    build:
      context: ./api
      dockerfile: Dockerfile.dev
    restart: always
    volumes:
      - ./api:/code
    networks:
      cancer_network:
        aliases:
          - ${HOST_ALIAS}
    ports:
      - "${API_PORT}:${API_PORT}"
    command: sh -c "npm run dev"
  
  tumor-detector-2d:
    build:
      context: ./models/tumor-detector-2d
    volumes:
        - ./models/tumor-detector-2d/data:/code/data
        - ./models/tumor-detector-2d/artifacts:/code/artifacts
        - ./models/tumor-detector-2d/checkpoints:/code/checkpoints
        - ./models/tumor-detector-2d/trained-model:/code/trained-model
    ports:
      - "${MODEL_TUMOR_DETECTOR_2D_PORT}:${MODEL_TUMOR_DETECTOR_2D_PORT}"
    networks:
      - cancer_network
    environment:
      - MODE=${MODE}
    command: sh -c "python3 index.py"
